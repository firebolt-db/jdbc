name: Run integration tests

on:
  workflow_dispatch:
    inputs:
      database1:
        description: 'Database (v1) - a new one will be created if not provided'
        required: false
        default: ''
      database2:
        description: 'Database (v2) - a new one will be created if not provided'
        required: false
        default: ''
      engine1:
        description: 'Engine (v1) - a new one will be created if not provided'
        required: false
      engine2:
        description: 'Engine (v2) - a new one will be created if not provided'
        required: false
      account:
        description: 'Account'
        required: true
        default: 'developer'
      environment:
        description: 'Environment to run the tests against'
        type: choice
        required: true
        default: 'staging'
        options:
          - dev
          - staging
      run-v1:
        description: 'Run tests against Firebolt DB v1'
        required: true
        default: true
        type: choice
        options:
          - 'true'
          - 'false'
      run-v2:
        description: 'Run tests against Firebolt DB v2'
        required: true
        default: true
        type: choice
        options:
          - 'true'
          - 'false'

jobs:
  run-integration-tests1:
    if: ${{ github.event.inputs.run-v1 }}
    uses: ./.github/workflows/integration-test-v1.yml
    with:
      database: ${{ github.event.inputs.database1 }}
      engine: ${{ github.event.inputs.engine1 }}
      environment: ${{ github.event.inputs.environment }}
    secrets:
      FIREBOLT_USERNAME_STAGING: ${{ secrets.FIREBOLT_USERNAME_STAGING }}
      FIREBOLT_PASSWORD_STAGING: ${{ secrets.FIREBOLT_PASSWORD_STAGING }}
      FIREBOLT_USERNAME_DEV: ${{ secrets.FIREBOLT_USERNAME_DEV }}
      FIREBOLT_PASSWORD_DEV: ${{ secrets.FIREBOLT_PASSWORD_DEV }}

  run-integration-tests2:
    if: ${{ github.event.inputs.run-v2 }}
    uses: ./.github/workflows/integration-test-v2.yml
    with:
      database: ${{ github.event.inputs.database2 }}
      engine: ${{ github.event.inputs.engine2 }}
      environment: ${{ github.event.inputs.environment }}
      account: ${{ github.event.inputs.account }}
    secrets:
      FIREBOLT_CLIENT_ID_STG_NEW_IDN: ${{ secrets.FIREBOLT_CLIENT_ID_STG_NEW_IDN }}
      FIREBOLT_CLIENT_SECRET_STG_NEW_IDN: ${{ secrets.FIREBOLT_CLIENT_SECRET_STG_NEW_IDN }}
      FIREBOLT_CLIENT_ID_NEW_IDN: ${{ secrets.FIREBOLT_CLIENT_ID_NEW_IDN }}
      FIREBOLT_CLIENT_SECRET_NEW_IDN: ${{ secrets.FIREBOLT_CLIENT_SECRET_NEW_IDN }}

